{
    "query": "WITH RecentOrders AS (\n    SELECT \n        o.warehouse_id,\n        w.city,\n        o.paid_amount\n    FROM \n        orders o\n        INNER JOIN warehouses w ON o.warehouse_id = w.warehouse_id\n    WHERE \n        o.date >= datetime('2024-06-10', '-14 days')\n),\nWarehouseAvg AS (\n    SELECT \n        warehouse_id,\n        AVG(paid_amount) AS avg_order_warehouse\n    FROM \n        RecentOrders\n    GROUP BY \n        warehouse_id\n),\nCityAvg AS (\n    SELECT \n        city,\n        AVG(paid_amount) AS avg_order_city\n    FROM \n        RecentOrders\n    GROUP BY \n        city\n)\nSELECT \n    w.name AS warehouse_name,\n    rc.city,\n    wa.avg_order_warehouse,\n    ca.avg_order_city\nFROM \n    WarehouseAvg wa\n    INNER JOIN warehouses w ON wa.warehouse_id = w.warehouse_id\n    INNER JOIN (\n        SELECT DISTINCT\n            ro.warehouse_id,\n            ro.city\n        FROM RecentOrders ro\n    ) rc ON wa.warehouse_id = rc.warehouse_id\n    INNER JOIN CityAvg ca ON rc.city = ca.city\nWHERE \n    wa.avg_order_warehouse > ca.avg_order_city\nORDER BY \n    w.name;\n",
    "result": [
        {
            "warehouse_name": "алл. Крайняя",
            "city": "Певек",
            "avg_order_warehouse": 4250.08,
            "avg_order_city": 2375.1166666666663
        },
        {
            "warehouse_name": "алл. Металлистов",
            "city": "Иркутск",
            "avg_order_warehouse": 4765.42,
            "avg_order_city": 3652.49
        },
        {
            "warehouse_name": "алл. Стахановская",
            "city": "Асбест",
            "avg_order_warehouse": 4095.62,
            "avg_order_city": 3363.55
        },
        {
            "warehouse_name": "бул. Весенний",
            "city": "Сковородино",
            "avg_order_warehouse": 4120.93,
            "avg_order_city": 3081.8033333333333
        },
        {
            "warehouse_name": "наб. Куйбышева",
            "city": "Черняховск",
            "avg_order_warehouse": 2092.96,
            "avg_order_city": 1495.565
        },
        {
            "warehouse_name": "наб. Невского",
            "city": "Тольятти",
            "avg_order_warehouse": 3023.32,
            "avg_order_city": 3016.76
        },
        {
            "warehouse_name": "наб. Степная",
            "city": "Красноуральск",
            "avg_order_warehouse": 4634.47,
            "avg_order_city": 3322.756666666666
        },
        {
            "warehouse_name": "наб. Центральная",
            "city": "Сковородино",
            "avg_order_warehouse": 3261.48,
            "avg_order_city": 3081.8033333333333
        },
        {
            "warehouse_name": "пер. Пушкинский",
            "city": "Красноуральск",
            "avg_order_warehouse": 4513.99,
            "avg_order_city": 3322.756666666666
        },
        {
            "warehouse_name": "пр. 1 Мая",
            "city": "Сызрань",
            "avg_order_warehouse": 4179.44,
            "avg_order_city": 2147.865
        },
        {
            "warehouse_name": "пр. Луговой",
            "city": "Ноябрьск",
            "avg_order_warehouse": 1582.22,
            "avg_order_city": 1396.21
        },
        {
            "warehouse_name": "ул. Киевская",
            "city": "Троицк",
            "avg_order_warehouse": 4308.15,
            "avg_order_city": 2908.2349999999997
        },
        {
            "warehouse_name": "ул. Октябрьская",
            "city": "Усинск",
            "avg_order_warehouse": 4966.53,
            "avg_order_city": 2911.52
        },
        {
            "warehouse_name": "ул. Пушкинская",
            "city": "Казань",
            "avg_order_warehouse": 4474.15,
            "avg_order_city": 3781.845
        },
        {
            "warehouse_name": "ул. Щетинкина",
            "city": "Шенкурск",
            "avg_order_warehouse": 3322.31,
            "avg_order_city": 2695.105
        },
        {
            "warehouse_name": "ш. Урожайное",
            "city": "Байкальск",
            "avg_order_warehouse": 3592.11,
            "avg_order_city": 2001.525
        }
    ],
    "error": null
}